<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Results - Assessment System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .results-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .score-card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        .question-result {
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .question-result:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        .excellent { background: #28a745; color: white; }
        .good { background: #ffc107; color: black; }
        .average { background: #fd7e14; color: white; }
        .poor { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-graduation-cap"></i> Assessment System
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('main.student_dashboard', student_id=student_id) }}">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a class="nav-link" href="{{ url_for('main.logout') }}">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Results Header -->
        <div class="results-header text-center">
            <h1><i class="fas fa-chart-line"></i> Examination Results</h1>
            <p class="mb-0">Student ID: {{ student_id }}</p>
            <p class="mb-0">Detailed Performance Report</p>
        </div>

        <!-- Overall Score Summary -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card score-card h-100">
                    <div class="card-body text-center">
                        <div class="score-circle mx-auto mb-3 
                            {% if total_marks >= 80 %}excellent
                            {% elif total_marks >= 60 %}good
                            {% elif total_marks >= 40 %}average
                            {% else %}poor{% endif %}">
                            {{ total_marks }}
                        </div>
                        <h5>Total Marks</h5>
                        <p class="text-muted">Overall Score</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card score-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-question-circle fa-3x text-primary mb-3"></i>
                        <h3>{{ results|length }}</h3>
                        <h5>Questions Attempted</h5>
                        <p class="text-muted">Total Questions</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card score-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-percentage fa-3x text-success mb-3"></i>
                        <h3>
                            {% if results|length > 0 %}
                                {{ "%.1f"|format((total_marks / (results|length * 10)) * 100) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </h3>
                        <h5>Success Rate</h5>
                        <p class="text-muted">Performance Percentage</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grade Analysis -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-chart-bar"></i> Grade Analysis</h4>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <h5>
                                    {% if total_marks >= 80 %}
                                        <span class="badge bg-success">A</span>
                                    {% elif total_marks >= 60 %}
                                        <span class="badge bg-warning">B</span>
                                    {% elif total_marks >= 40 %}
                                        <span class="badge bg-orange">C</span>
                                    {% else %}
                                        <span class="badge bg-danger">F</span>
                                    {% endif %}
                                </h5>
                                <p>Letter Grade</p>
                            </div>
                            <div class="col-md-3">
                                <h5>
                                    {% if total_marks >= 80 %}Excellent
                                    {% elif total_marks >= 60 %}Good
                                    {% elif total_marks >= 40 %}Satisfactory
                                    {% else %}Needs Improvement{% endif %}
                                </h5>
                                <p>Performance</p>
                            </div>
                            <div class="col-md-3">
                                <h5>{{ final_score if final_score else 'N/A' }}</h5>
                                <p>Final Score</p>
                            </div>
                            <div class="col-md-3">
                                <h5>
                                    {% set avg = total_marks / results|length if results|length > 0 else 0 %}
                                    {{ "%.1f"|format(avg) }}
                                </h5>
                                <p>Average per Question</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Results -->
        <div class="card">
            <div class="card-header">
                <h4><i class="fas fa-list-alt"></i> Detailed Question Results</h4>
            </div>
            <div class="card-body">
                {% if results %}
                    {% for result in results %}
                        <div class="card question-result">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-1">
                                        <div class="text-center">
                                            <div class="score-circle mx-auto
                                                {% if result.predicted_marks >= 8 %}excellent
                                                {% elif result.predicted_marks >= 6 %}good
                                                {% elif result.predicted_marks >= 4 %}average
                                                {% else %}poor{% endif %}" 
                                                style="width: 50px; height: 50px; font-size: 0.9em;">
                                                {{ result.predicted_marks or 0 }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><strong>Question {{ loop.index }}:</strong></h6>
                                        <p class="mb-1 text-truncate">{{ result.question_text[:100] }}...</p>
                                        <small class="text-muted">
                                            <i class="fas fa-edit"></i> Answer: {{ result.student_answer[:50] }}...
                                        </small>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="row text-center">
                                            <div class="col-4">
                                                <small class="text-muted">Similarity</small>
                                                <div class="fw-bold">{{ "%.1f"|format(result.similarity or 0) }}%</div>
                                            </div>
                                            <div class="col-4">
                                                <small class="text-muted">Grammar</small>
                                                <div class="fw-bold text-{{ 'success' if (result.grammar_mistakes or 0) < 3 else 'warning' }}">
                                                    {{ result.grammar_mistakes or 0 }} errors
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <small class="text-muted">Words</small>
                                                <div class="fw-bold">{{ result.word_count or 0 }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No Results Available</h5>
                        <p class="text-muted">You haven't taken any exams yet.</p>
                        <a href="{{ url_for('main.student_dashboard', student_id=student_id) }}" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Go to Dashboard
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="{{ url_for('main.student_dashboard', student_id=student_id) }}" class="btn btn-primary me-2">
                    <i class="fas fa-home"></i> Back to Dashboard
                </a>
                <button onclick="window.print()" class="btn btn-outline-primary me-2">
                    <i class="fas fa-print"></i> Print Results
                </button>
                <a href="#" class="btn btn-outline-success" onclick="downloadResults()">
                    <i class="fas fa-download"></i> Download PDF
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function downloadResults() {
            alert('PDF download feature will be implemented soon!');
        }

        // Add animation to result cards
        document.addEventListener('DOMContentLoaded', function() {
            const resultCards = document.querySelectorAll('.question-result');
            resultCards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    card.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 100);
            });
        });
    </script>
</body>
</html>
